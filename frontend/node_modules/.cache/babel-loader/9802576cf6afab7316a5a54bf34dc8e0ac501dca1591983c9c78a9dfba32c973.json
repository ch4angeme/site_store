{"ast":null,"code":"import { createElementVNode as _createElementVNode, toDisplayString as _toDisplayString, resolveComponent as _resolveComponent, openBlock as _openBlock, createBlock as _createBlock, createCommentVNode as _createCommentVNode, renderList as _renderList, Fragment as _Fragment, createElementBlock as _createElementBlock, createTextVNode as _createTextVNode } from \"vue\";\nconst _hoisted_1 = {\n  class: \"product-list\"\n};\nconst _hoisted_2 = [\"onClick\"];\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_Cart = _resolveComponent(\"Cart\");\n  return _openBlock(), _createElementBlock(\"div\", null, [_cache[1] || (_cache[1] = _createElementVNode(\"h1\", null, \"Каталог товаров\", -1 /* HOISTED */)), _createElementVNode(\"button\", {\n    onClick: _cache[0] || (_cache[0] = (...args) => $options.toggleCart && $options.toggleCart(...args))\n  }, _toDisplayString($data.isCartVisible ? 'Скрыть корзину' : 'Показать корзину'), 1 /* TEXT */), $data.isCartVisible ? (_openBlock(), _createBlock(_component_Cart, {\n    key: 0,\n    cart: $data.cart,\n    onRemove: $options.removeFromCart,\n    onClose: $options.toggleCart\n  }, null, 8 /* PROPS */, [\"cart\", \"onRemove\", \"onClose\"])) : _createCommentVNode(\"v-if\", true), _createElementVNode(\"ul\", _hoisted_1, [(_openBlock(true), _createElementBlock(_Fragment, null, _renderList($data.products, item => {\n    return _openBlock(), _createElementBlock(\"li\", {\n      key: item.id\n    }, [_createTextVNode(_toDisplayString(item.name) + \" - \" + _toDisplayString(item.price) + \" рублей \", 1 /* TEXT */), _createElementVNode(\"button\", {\n      onClick: $event => $options.addToCart(item)\n    }, \"Добавить в корзину\", 8 /* PROPS */, _hoisted_2)]);\n  }), 128 /* KEYED_FRAGMENT */))])]);\n}","map":{"version":3,"names":["class","_createElementBlock","_createElementVNode","onClick","_cache","args","$options","toggleCart","$data","isCartVisible","_createBlock","_component_Cart","key","cart","onRemove","removeFromCart","onClose","_createCommentVNode","_hoisted_1","_Fragment","_renderList","products","item","id","_createTextVNode","_toDisplayString","name","price","$event","addToCart","_hoisted_2"],"sources":["D:\\JetBrains\\PROJECTPY\\cite_store\\frontend\\src\\views\\ProductsPage.vue"],"sourcesContent":["<template>\r\n  <div>\r\n    <h1>Каталог товаров</h1>\r\n    <button @click=\"toggleCart\">{{ isCartVisible ? 'Скрыть корзину' : 'Показать корзину' }}</button>\r\n\r\n    <Cart\r\n      v-if=\"isCartVisible\"\r\n      :cart=\"cart\"\r\n      @remove=\"removeFromCart\"\r\n      @close=\"toggleCart\"\r\n    />\r\n\r\n    <ul class=\"product-list\">\r\n      <li v-for=\"item in products\" :key=\"item.id\">\r\n        {{ item.name }} - {{ item.price }} рублей\r\n        <button @click=\"addToCart(item)\">Добавить в корзину</button>\r\n      </li>\r\n    </ul>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport axios from 'axios'; // import axios for execution HTTP-requests\r\nimport Cart from '../components/CartPage.vue';\r\n\r\nexport default {\r\n  components: {\r\n    Cart,\r\n  },\r\n  data() {\r\n    return {\r\n      isCartVisible: false,\r\n      products: [], // empty mass for products\r\n      cart: [],\r\n    };\r\n  },\r\n  methods: {\r\n    async fetchProducts() {\r\n      try {\r\n        const response = await axios.get('http://127.0.0.1:5000/api/all_products'); // get-request for server\r\n        this.products = response.data.results || []; // catch the api and take data\r\n      } catch (error) {\r\n        console.error('Error:', error);\r\n      }\r\n    },\r\n    toggleCart() {\r\n      this.isCartVisible = !this.isCartVisible;\r\n    },\r\n    async addToCart(item) {\r\n  try {\r\n    // Проверка наличия токена\r\n    const token = localStorage.getItem('access_token');\r\n    const username = localStorage.getItem('username');\r\n\r\n    if (!token) {\r\n      throw new Error(\"Токен не найден. Пожалуйста, выполните вход.\");\r\n    }\r\n\r\n    // Проверка наличия product_id\r\n    if (!item || !item.id) {\r\n      throw new Error(\"Некорректные данные товара. Убедитесь, что у товара есть id.\");\r\n    }\r\n\r\n    // Подготовка данных для запроса\r\n    const requestData = {\r\n      username: username, // Имя пользователя\r\n      product_id: item.id // Идентификатор продукта\r\n    };\r\n\r\n    console.log(\"Отправляемые данные:\", requestData); // Для отладки\r\n\r\n    // Отправка запроса на добавление товара в корзину\r\n    const response = await axios.post('http://localhost:5000/api/cart/add', requestData, {\r\n      headers: {\r\n        Authorization: `Bearer ${token}`,\r\n        'Content-Type': 'application/json'\r\n      }\r\n    });\r\n\r\n    // Обработка успешного ответа\r\n    if (response.status === 201) {\r\n      this.cart.push(item);\r\n      console.log(\"Товар успешно добавлен в корзину!\");\r\n    }\r\n  } catch (error) {\r\n    // Логирование ошибки\r\n    console.error(\"Ошибка при добавлении товара в корзину:\", error.response ? error.response.data : error.message);\r\n  }\r\n},\r\n    removeFromCart(item) {\r\n      this.cart = this.cart.filter(cartItem => cartItem.id !== item.id);\r\n    },\r\n  },\r\n  mounted() {\r\n    this.fetchProducts(); // calling the method for getting api with products\r\n  },\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n.product-list {\r\n  display: flex;\r\n  flex-wrap: wrap;\r\n  margin-left: 50px; /* Изменено для лучшего отображения */\r\n  margin-right: 50px; /* Изменено для лучшего отображения */\r\n  list-style-type: none; /* Убираем маркеры списка */\r\n  padding: 0; /* Убираем отступы */\r\n}\r\n\r\n.product-list li {\r\n  margin: 10px; /* Отступы между товарами */\r\n  padding: 10px;\r\n  border: 1px solid #ccc; /* Граница для каждого товара */\r\n  border-radius: 5px; /* Закругленные углы */\r\n  width: 200px; /* Ширина элемента списка */\r\n  text-align: center; /* Центрирование текста */\r\n}\r\n</style>"],"mappings":";;EAYQA,KAAK,EAAC;AAAc;mBAZ5B;;;uBACEC,mBAAA,CAiBM,c,0BAhBJC,mBAAA,CAAwB,YAApB,iBAAe,sBACnBA,mBAAA,CAAgG;IAAvFC,OAAK,EAAAC,MAAA,QAAAA,MAAA,UAAAC,IAAA,KAAEC,QAAA,CAAAC,UAAA,IAAAD,QAAA,CAAAC,UAAA,IAAAF,IAAA,CAAU;sBAAKG,KAAA,CAAAC,aAAa,0DAGpCD,KAAA,CAAAC,aAAa,I,cADrBC,YAAA,CAKEC,eAAA;IAVNC,GAAA;IAOOC,IAAI,EAAEL,KAAA,CAAAK,IAAI;IACVC,QAAM,EAAER,QAAA,CAAAS,cAAc;IACtBC,OAAK,EAAEV,QAAA,CAAAC;8DATdU,mBAAA,gBAYIf,mBAAA,CAKK,MALLgB,UAKK,I,kBAJHjB,mBAAA,CAGKkB,SAAA,QAhBXC,WAAA,CAayBZ,KAAA,CAAAa,QAAQ,EAAhBC,IAAI;yBAAfrB,mBAAA,CAGK;MAHyBW,GAAG,EAAEU,IAAI,CAACC;QAb9CC,gBAAA,CAAAC,gBAAA,CAcWH,IAAI,CAACI,IAAI,IAAG,KAAG,GAAAD,gBAAA,CAAGH,IAAI,CAACK,KAAK,IAAG,UAClC,iBAAAzB,mBAAA,CAA4D;MAAnDC,OAAK,EAAAyB,MAAA,IAAEtB,QAAA,CAAAuB,SAAS,CAACP,IAAI;OAAG,oBAAkB,iBAf3DQ,UAAA,E","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}